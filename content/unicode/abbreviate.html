<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="save characters in Tweets in dubiously useful ways">
<title>abbreviate</title>
<script src="/unicode/abbreviate.js"></script>
<style>
	html,body {
		font-size:18px;
		color:#fff;
		background-color:#113;
		font-family:sans-serif;
		padding:0;
		margin:0;
		border:none;
	}

	a {
		color:#99f;
	}

	a:hover {
		color:#f99;
	}

	.rule {
		width:100%;
		height:0;
		border-bottom:1px #99f dashed;
		margin:20px 0;
	}

	#container {
		margin:25px;
		max-width:600px;
	}

	.inline {
		display:inline;
	}

	.text_box {
		border:1px #fff solid;
		margin:10px 0;
		padding:10px;
	}
</style>
<div id="container">
	Type here: <div id="chars_in" class="inline">60</div>
	<div id="in" contenteditable="true" class="text_box">
	gallantly she rode on, looking rad as hell in her new shoes
	</div>
	Results here: <div id="chars_out" class="inline">52</div>
	<div id="out" contenteditable="true" class="text_box">
	&#x33FF;lantly she rode on, l&#xA74F;k&#x33CC;g &#x33AD; as he&#x2161; &#x33CC; her new shoes
	</div>
	Compression ratio:
	<div id="compression_ratio" class="inline">1.154:1, 8 characters saved</div>
	<div class="rule"> </div>
	Created by <a href="/">rebecca turner</a> with help from <a href="https://twitter.com/FakeUnicode">@FakeUnicode</a>
	<p><a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a> (a format for encoding characters) contains thousands of superfluous and unnecessary characters, almost 200 of which represent multiple latin characters together (that I&#x2019;ve found, that is&#x2014;there are probably others). By swapping out multiple characters in the input with the singular characters from Unicode, we can create a text with a lower overall character count, which you can then use to tweet longer (the consequence of doing this is that your tweets will look a little bit like a ransom note).
	<p>On average, you&#x2019;ll see savings of around 4&#x2013;9%, which means around 5&#x2013;12 extra characters per tweet. If you&#x2019;re tweeting nothing but &#x201C;a.m.&#x201D; and &#x201C;p.m.&#x201D; you&#x2019;ll see savings of 400% (I don&#x2019;t know why you would want to do that).
</div>
<script>
//note: table.js (containing an object with pairs of replacements to make) has been loaded
//it contains a variable named "replacements"

//init variables
var textIn = document.getElementById("in")
	,textOut = document.getElementById("out")
	,textFiltered = ""
	,textRaw = ""
	,compressionRatio = 1
	,textRatio = document.getElementById("compression_ratio")
	,charsIn = document.getElementById("chars_in")
	,charsOut = document.getElementById("chars_out")
	,regexAstralSymbols = /[\uD800-\uDBFF][\uDC00-\uDFFF]/g;

function filter(text, pairs) { //takes a string and an object with pairs to replace
	var result = "";
	for(var i = 0; i < text.length; i++) {
		if(pairs[text.substring(i,i+4)]) { //if the current 4 chars exist as a pair, replace
			result += pairs[text.substring(i,i+4)];
			i += 3;
		} else if(pairs[text.substring(i,i+3)]) {
			result += pairs[text.substring(i,i+3)];
			i += 2;
		} else if(pairs[text.substring(i,i+2)]) {
			result += pairs[text.substring(i,i+2)];
			i += 1;
		} else {
			result += text[i]; //otherwise, replace current char
		}
	}
	return result;
}


function countSymbols(string) {
	//this function is from here https://mathiasbynens.be/notes/javascript-unicode
	//(thanks mathias)
	return string
	// replace every surrogate pair with a bmp symbol to acct for 5 or 6 byte unicode symbols
	.replace(regexAstralSymbols, '.')
	// then get the length
	.length;
}

function selectAll() { //function to select text when the text boxes are clicked
	window.setTimeout(function() {//browsers are weird about this (it doesnt work w/o a delay)
		document.execCommand("selectAll", false, null); //can you believe there's a function containing 'exec' that isn't a huge security hole?
	}, 1);
}

textIn.addEventListener("input", function(e) { //when text is input (covers pastes as well as keys)
	textRaw = textIn.innerHTML.replace(/<[^>]*>?/g,""); //refresh contents of textRaw & regex out xml tags
	textOut.innerHTML = textFiltered = filter(textRaw, replacements); //refresh textFiltered and output
	textRatio.innerHTML = compressionRatio = Math.round((countSymbols(textRaw)/countSymbols(textFiltered)) * 1000) / 1000; //output comp. ratio
	textRatio.innerHTML += ":1, " + (countSymbols(textRaw) - countSymbols(textFiltered)) + " characters saved"; //and add the stats
	charsIn.innerHTML = countSymbols(textRaw); //update character counters
	charsOut.innerHTML = countSymbols(textFiltered);
}, false);

textIn.addEventListener("focus", function(e) { //select all text when focused
	selectAll();
}, false);

textOut.addEventListener("focus", function(e) {
	selectAll();
}, false);
</script>
